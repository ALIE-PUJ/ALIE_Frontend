<app-sidebar>
  <div class="main">
    <div class="containerp">
      <div class="left">
        <!-- Botón para añadir un nuevo chat -->
        <div class="nuevo_chat" (click)="addNewChat()">
          <p>Nuevo Chat</p>
        </div>

        <!-- Historial de chats del usuario -->
        <div class="historial_chat">
          <div *ngFor="let chat of chats" class="historial" (click)="switchChat(chat.memory_key)"
            [class.active]="chat.memory_key === activeChatId">
            <div class="botones">
              <i class="bi bi-chat-left"></i>
            </div>
            <!-- Título del chat en el panel izquierdo -->
            <p class="titulo">{{ chat.title || 'Chat sin título' }}</p>

            <!-- Opciones para renombrar, archivar y eliminar chats -->
            <div class="menu">
              <i class="bi bi-three-dots-vertical menu-icon" (click)="toggleOptions(chat.memory_key)"></i>
              <div *ngIf="chat.showOptions" class="menu-options" (click)="$event.stopPropagation()">
                <div class="option" (click)="renameChat(chat.memory_key)">
                  <i class="bi bi-pencil"></i>
                  <span>Renombrar</span>
                </div>
                <div class="option" (click)="archiveChat(chat.memory_key)">
                  <i class="bi bi-archive"></i>
                  <span>Archivar</span>
                </div>
                <div class="option" (click)="deleteChat(chat.memory_key)">
                  <i class="bi bi-trash"></i>
                  <span>Eliminar</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="right">
        <!-- Título del chat activo -->
        <h1 *ngIf="messages.length === 0">
          {{ getActiveChatTitle() }}
        </h1>

        <!-- Subtítulo cuando no hay mensajes en el chat -->
        <div class="subtitulo" *ngIf="messages.length === 0">
          <p>¿Qué pregunta académica tienes el día de hoy?</p>
        </div>

        <!-- Lista de mensajes en el chat -->
        <div class="messages">

          <div *ngFor="let message of messages" class="message-container">
            <p [ngClass]="{
                'agent-message': message.sender === 'agent',
                'user-message': message.sender === 'user'
              }">
              {{ message.content }}
            </p>

            <!-- Iconos de interacción con los mensajes del agente -->
            <div *ngIf="message.sender === 'agent'" class="message-icons">
              <i class="bi bi-hand-thumbs-up-fill" (click)="handleThumbUp(message)"></i>
              <i class="bi bi-hand-thumbs-down-fill" (click)="handleThumbDown(message)"></i>
              <i class="bi bi-arrow-repeat" (click)="handleRetry(message)"></i>
            </div>

            <!-- Caja de confirmación para intervención humana -->
            <div class="confirmation-box" *ngIf="showConfirmation">
              <div class="confirmation-content">
                <p>¿Quieres hablar con una persona?</p>
                <div class="confirmation-options">
                  <button (click)="handleYes()">Sí</button>
                  <button (click)="handleNo()">No, seguir con ALIE</button>
                </div>
              </div>
            </div>
          </div>

        </div>

        <!-- Navegación: campo para enviar mensajes -->

        <!-- Mensaje de carga -->
        <div *ngIf="isLoading" class="message-container loading-message">
          <p>{{ loadingMessage }}<span class="loading-dots">{{ loadingDots }}</span></p>
        </div>

        <div class="navegacion">
          <input type="text" class="texto" placeholder="Envía un mensaje..." [(ngModel)]="message"
            (keydown.enter)="sendMessage()" />
          <i class="bi bi-send" (click)="sendMessage()"></i>
          <p>ALIE - Trabajo de grado - Pontificia Universidad Javeriana</p>
        </div>
      </div>
    </div>
  </div>
</app-sidebar>